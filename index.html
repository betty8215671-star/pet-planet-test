<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>毛孩行星測驗</title>
    <link href="https://fonts.googleapis.com/css2?family=Kiwi+Maru:wght@500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body, html { width: 100%; height: 100%; background-color: #000; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; display: flex; justify-content: center; align-items: center; }
        
        .wrapper { 
            position: relative; 
            height: 100vh; 
            aspect-ratio: 9 / 16; 
            background-color: #000;
            display: flex; justify-content: center; align-items: center;
        }
        .bg-img { width: 100%; height: 100%; object-fit: contain; }
        .page { display: none; width: 100%; height: 100%; position: absolute; }
        .active { display: block; }

        /* --- Page 3: 基礎輸入資料對齊 --- */
        .input-item { position: absolute; left: 50%; transform: translateX(-50%); width: 52%; height: 4.5%; background: transparent; border: none; outline: none; font-size: 2.2vh; font-weight: bold; color: #444; text-align: center; }
        .name-field { top: 36.5%; }
        .birth-field { top: 49.5%; padding-right: 2vh; }
        .gender-field { top: 66.0%; appearance: none; cursor: pointer; }

        /* --- Page 4: 星球文字位置修正 --- */
        .desc-container { position: absolute; bottom: 22.5%; left: 50%; transform: translateX(-50%); width: 80%; text-align: center; z-index: 100; }
        .desc-title { font-weight: 900; font-size: 2.8vh; color: #FFD700; margin-bottom: 6vh; display: block; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .desc-content { font-size: 2vh; color: #FFFFFF; line-height: 1.5; font-weight: bold; display: block; }

        /* --- Page 5: 護照頁精準入格 --- */
        #passport-area { position: absolute; top: 22.5%; left: 16.5%; width: 67%; height: 28.5%; }
        .pass-photo { position: absolute; top: 18%; left: 13.5%; width: 29%; height: 54%; border-radius: 8px; object-fit: cover; opacity: 0; }
        .pass-text { font-family: 'Kiwi Maru', serif; position: absolute; color: #5D4037; font-weight: 500; white-space: nowrap; }
        .p-name { top: 25%; left: 63%; font-size: 1.8vh; } 
        .p-birth { top: 38%; left: 65%; font-size: 1.6vh; } 
        .p-element { top: 49%; left: 65%; font-size: 1.8vh; } 
        .p-no { position: absolute; bottom: 6%; left: 13.5%; font-size: 1.2vh; color: #6D4C41; }
        
        /* 完整文案樣式 */
        .hook-text { position: absolute; top: 54.5%; left: 50%; transform: translateX(-50%); width: 75%; text-align: center; color: #FFF; font-size: 1.9vh; font-weight: bold; line-height: 1.6; }

        /* 其他元件 */
        .upload-zone { position: absolute; top: 48%; left: 50%; transform: translate(-50%, -50%); width: 22vh; height: 22vh; border-radius: 50%; overflow: hidden; }
        #preview-img { width: 100%; height: 100%; object-fit: cover; display: none; }
        #file-input { position: absolute; width: 100%; height: 100%; opacity: 0; }
        .planet { position: absolute; cursor: pointer; transform: translate(-50%, -50%); }
        #p-wood { width: 8%; top: 51%; left: 40%; } #p-fire { width: 12%; top: 41%; left: 63%; }
        #p-earth { width: 20%; top: 36.5%; left: 28%; } #p-metal { width: 14%; top: 52%; left: 62%; }
        #p-water { width: 10%; top: 56%; left: 25%; }
    </style>
</head>
<body>
    <div class="wrapper">
        <div id="page1" class="page active" onclick="showPage('page2')"><img src="cover-bg.PNG" class="bg-img"></div>
        <div id="page2" class="page">
            <img src="page2-bg.PNG" class="bg-img">
            <div class="upload-zone"><input type="file" id="file-input" onchange="previewFile()"><img id="preview-img"></div>
            <div style="position:absolute; bottom:23%; left:50%; transform:translateX(-50%); width:50%; height:8%;" onclick="showPage('page3')"></div>
        </div>
        <div id="page3" class="page">
            <img src="page3-bg.PNG" class="bg-img">
            <input type="text" class="input-item name-field" id="pet-name" placeholder="請輸入姓名">
            <input type="date" class="input-item birth-field" id="pet-birth">
            <select class="input-item gender-field" id="pet-gender">
                <option value="" disabled selected>請選擇性別</option>
                <option value="男生">男生</option>
                <option value="女生">女生</option>
            </select>
            <div style="position:absolute; bottom:17%; left:50%; transform:translateX(-50%); width:40%; height:8%;" onclick="validateInfo()"></div>
        </div>
        <div id="page4" class="page">
            <img src="page4-bg.PNG" class="bg-img">
            <img src="wood.PNG" class="planet" id="p-wood" onclick="selectPlanet('wood', '木星')">
            <img src="fire.PNG" class="planet" id="p-fire" onclick="selectPlanet('fire', '火星')">
            <img src="earth.PNG" class="planet" id="p-earth" onclick="selectPlanet('earth', '土星')">
            <img src="metal.PNG" class="planet" id="p-metal" onclick="selectPlanet('metal', '金星')">
            <img src="water.PNG" class="planet" id="p-water" onclick="selectPlanet('water', '水星')">
            <div class="desc-container" id="desc-box"><div class="desc-content">點擊星球，探索毛孩的內心世界...</div></div>
            <div style="position:absolute; bottom:14%; left:50%; transform:translateX(-50%); width:50%; height:8%;" onclick="generateCard()"></div>
        </div>
        <div id="page5" class="page">
            <img src="page5-bg.PNG" class="bg-img">
            <div id="passport-area">
                <img src="" id="final-photo" class="pass-photo">
                <div class="pass-text p-name" id="res-name"></div>
                <div class="pass-text p-birth" id="res-birth"></div>
                <div class="pass-text p-element" id="res-planet"></div>
                <div class="p-no" id="res-no"></div>
            </div>
            <div class="hook-text" id="hook-desc"></div>
            <div style="position:absolute; top:65.5%; left:50%; transform:translateX(-50%); width:60%; height:6.5%;" onclick="window.open('https://forms.gle/7ZNBPMad8CDTXxit8', '_blank')"></div>
            <div style="position:absolute; bottom:18.5%; left:50%; transform:translateX(-50%); width:40%; height:4.5%;" onclick="downloadPassport()"></div>
        </div>
    </div>

    <script>
        let currentChoice = ""; let currentPlanetName = "";
        const traits = { 'wood': '行動派冒險型', 'fire': '社交發光體型', 'earth': '穩定守護型', 'metal': '獨立思考型', 'water': '靈魂纖細、思考敏感型' };
        const planetInfo = {
            'wood': { title: '【行動之星】', text: '活力充沛的冒險家，直率又熱情。' },
            'fire': { title: '【熱情之星】', text: '天生的社交發光體，渴望你的關注。' },
            'earth': { title: '【療癒之星】', text: '隨和知足的守護者，最愛窩在你身邊。' },
            'metal': { title: '【秩序之星】', text: '優雅獨立的指揮官，擁有自由的靈魂。' },
            'water': { title: '【靈魂之星】', text: '細膩聰穎的觀察者，溫柔地注視世界。' }
        };

        function showPage(p) { document.querySelectorAll('.page').forEach(x=>x.classList.remove('active')); document.getElementById(p).classList.add('active'); }
        function previewFile() { 
            const f = document.querySelector('#file-input').files[0]; 
            const r = new FileReader(); 
            r.onloadend = () => { localStorage.setItem('petPhoto', r.result); document.getElementById('preview-img').src = r.result; document.getElementById('preview-img').style.display='block'; }; 
            if(f) r.readAsDataURL(f); 
        }
        function validateInfo() { 
            const n = document.getElementById('pet-name').value; const b = document.getElementById('pet-birth').value;
            if(!n || !b) { alert("填寫完整後，就能啟動行星能量囉！"); return; }
            localStorage.setItem('petName', n); localStorage.setItem('petBirth', b); showPage('page4');
        }
        function selectPlanet(t, n) { 
            currentChoice = t; currentPlanetName = n; 
            document.getElementById('desc-box').innerHTML = `<span class="desc-title">${planetInfo[t].title}</span><span class="desc-content">${planetInfo[t].text}</span>`; 
        }
        function generateCard() {
            if(!currentChoice) { alert("請選擇一顆能量星球！"); return; }
            const n = localStorage.getItem('petName'); const b = localStorage.getItem('petBirth'); const p = localStorage.getItem('petPhoto');
            document.getElementById('res-name').innerText = n; document.getElementById('res-planet').innerText = currentPlanetName;
            const d = new Date(b); document.getElementById('res-birth').innerText = `${d.getDate().toString().padStart(2,'0')}.${(d.getMonth()+1).toString().padStart(2,'0')}.${d.getFullYear()}`;
            const rc = Math.random().toString(36).substring(2, 5).toUpperCase();
            document.getElementById('res-no').innerText = `NO. ${d.getFullYear()}${d.getDate()}.${n}.${rc}`;
            if(p) { document.getElementById('final-photo').src = p; document.getElementById('final-photo').style.opacity = "1"; }
            
            // 完整文案恢復
            document.getElementById('hook-desc').innerText = `${n} 的 ${currentPlanetName}能量豐富，屬於${traits[currentChoice]}。想知道這個屬性的體質特徵，以及有哪些好發疾病嗎？`;
            
            showPage('page5');
        }
        function downloadPassport() {
            const area = document.querySelector("#page5 .wrapper");
            html2canvas(area, { scale: 3 }).then(c => {
                const l = document.createElement('a');
                l.download = `Passport_Result.png`;
                l.href = c.toDataURL("image/png");
                l.click();
            });
        }
    </script>
</body>
</html>
